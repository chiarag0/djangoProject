{% extends "recipes/base.html" %}
{% load crispy_forms_filters %}
<!-- -->
{% load crispy_forms_tags %}
<!-- -->
{% block content %}
<div class="container">
  <form method="POST">
    {% csrf_token %}
    <fieldset class="form-group">
      <legend class="border-bottom mb-4">Add Recipe</legend>
      {{ form|crispy }}
    </fieldset>
   <div id="ingredient-fields">
        <div class="form-field">
            <label for="{{ form.ingredients.id_for_label }}">Ingredients:</label>

            <div id="ingredient-container">
                {% for ingredient in form.ingredients %}
                <div class="ingredient-field">
                    <div class="ingredient-input">
                        <label for="id_ingredients">Ingredient:</label>
                        <input type="text" name="ingredients" id="id_ingredients" value="{{ ingredient.name }}">
                    </div>
                    <div class="ingredient-input">
                        <label for="id_quantity">Quantity:</label>
                        <input type="text" name="quantity" id="id_quantity" value="{{ ingredient.amount }}">
                    </div>
                    <button type="button" class="remove-ingredient">Remove</button>
                </div>
                {% endfor %}
            </div>
            <button type="button" id="add-ingredient">Add Ingredient</button>
        </div>
     </div>


    <div class="form-group py-3">
      <input class="btn btn-outline-primary" type="submit" value="Save" />
    </div>
  </form>
  <div class="border-top pt-3">
    <a class="text-muted" href="{% url 'recipes-home' %}"
      >Cancel</a
    >
  </div>
</div>


  <script>
      document.addEventListener("DOMContentLoaded", function() {
      const ingredientContainer = document.getElementById("ingredient-container");
      const addIngredientBtn = document.getElementById("add-ingredient");

      function createIngredientField() {
        const ingredientField = document.createElement("div");
        ingredientField.classList.add("ingredient-field");

        const ingredientInput = document.createElement("div");
        ingredientInput.classList.add("ingredient-input");

        const ingredientLabel = document.createElement("label");
        ingredientLabel.setAttribute("for", "id_ingredients");
        ingredientLabel.textContent = "Ingredient:";

        const ingredientInputField = document.createElement("input");
        ingredientInputField.setAttribute("type", "text");
        ingredientInputField.setAttribute("name", "ingredients");
        ingredientInputField.setAttribute("id", "id_ingredients");

        ingredientInput.appendChild(ingredientLabel);
        ingredientInput.appendChild(ingredientInputField);

        const quantityInput = document.createElement("div");
        quantityInput.classList.add("ingredient-input");

        const quantityLabel = document.createElement("label");
        quantityLabel.setAttribute("for", "id_quantity");
        quantityLabel.textContent = "Quantity:";

        const quantityInputField = document.createElement("input");
        quantityInputField.setAttribute("type", "text");
        quantityInputField.setAttribute("name", "quantity");
        quantityInputField.setAttribute("id", "id_quantity");

        quantityInput.appendChild(quantityLabel);
        quantityInput.appendChild(quantityInputField);

        const removeBtn = document.createElement("button");
        removeBtn.setAttribute("type", "button");
        removeBtn.classList.add("remove-ingredient");
        removeBtn.textContent = "Remove";
        removeBtn.addEventListener("click", function() {
          ingredientField.remove();
        });

        ingredientField.appendChild(ingredientInput);
        ingredientField.appendChild(quantityInput);
        ingredientField.appendChild(removeBtn);

        return ingredientField;
      }

      addIngredientBtn.addEventListener("click", function() {
        const ingredientField = createIngredientField();
        ingredientContainer.appendChild(ingredientField);
      });
    });

  </script>
<!-- -->
{% endblock content %}